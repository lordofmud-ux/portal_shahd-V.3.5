{% extends 'main_app/base.html' %}
{% load static %}
{% block page_title %}{{ page_title }}{% endblock page_title %}
{% block content %}

    <style>
        .table_style {
            background-color: #2A6076;
        }

        th[scope="col"] {
            font-size: 14px;
            font-weight: bold;
            min-width: 9rem;
            vertical-align: middle;
        
        }
       

    
       

        .div-a-href {
            margin-bottom: 15px;
        }

        .a-href {
            border: 2px solid white;
            padding: 10px;
            font-size: 15px;
            color: #212A31;
            background-color: #D3D9D4;
            border-radius: 10px;
            display: block;
            margin-top: 10px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 5px;
            
        }

        .a-href:hover {
            color: white;
            background-color: #748D92;
        }

    
        @media (max-width: 768px) {
        th, td {
            font-size: 12px;
            white-space: nowrap;
        }
        }

       
     
       
    </style>

    <section class="content">
        <div class="container-fluid  d-flex  justify-content-center align-items-center">
            <div class="row w-100">

                <div class="container w-100 d-flex justify-content-center align-items-center flex-column ">

                    <div class="div-a-href w-100" style="display: block !important; ">
                        <a href="{% url 'device_panel_create' %}" class="a-href">پنل ایجاد کالا</a>
                        <a href="{% url 'device_panel_source_destination' %}" class="a-href">پنل مبدا و مقصد کالا</a>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered text-center table-hover table-valign-middle">
                        <thead class="thead-dark">
                        <tr>
                            <th scope="col">نام</th>
                            <th scope="col">شرکت</th>
                            <th scope="col">موجود</th>
                            <th scope="col">توضیحات</th>
                            <th scope="col">شماره</th>
                            <th scope="col">مکان</th>

                            <th scope="col">نام مصرف کننده</th>
                            <th scope="col">نام خانوادگی مصرف کننده</th>
                            <th scope="col">ایمیل مصرف کننده</th>
                            <th scope="col">امضا مصرف کننده</th>
                            <th scope="col">دپارتمان</th>
                            <th scope="col">اتاق</th>
                            <th scope="col">طبقه</th>
                            <th scope="col">ساختمان</th>
                            <th scope="col">قیمت</th>
                            <th scope="col">لینک دانلود</th>
                        </tr>
                        {% for device in devices %}
                            <tr>

                                {% if device.name != none %}
                                    <td class="td-class">{{ device.name }}</td>
                                {% elif device.name == none %}
                                    <td class="td-class"></td>
                                {% endif %}


                                {% if device.company != none %}
                                    <td class="td-class">{{ device.company }}</td>
                                {% elif device.company == none %}
                                    <td class="td-class"></td>
                                {% endif %}


                                {% if device.exist != none %}
                                    {% if device.exist == True %}
                                        <td class="td-class">موجود</td>
                                    {% elif device.exist == False %}
                                        <td class="td-class">ناموجود</td>
                                    {% endif %}
                                {% elif device.exist == none %}
                                    <td class="td-class"></td>
                                {% endif %}


                                {% if device.description != none %}
                                    <td class="description-class">{{ device.description }}</td>
                                {% elif device.description == none %}
                                    <td class="description-class"></td>
                                {% endif %}


                                {% if device.number != none %}
                                    <td class="td-class">{{ device.number }}</td>
                                {% elif device.number == none %}
                                    <td class="td-class"></td>
                                {% endif %}


                                {% if device.place != none %}
                                    <td class="td-class">{{ device.place }}</td>
                                {% elif device.place == none %}
                                    <td class="td-class"></td>
                                {% endif %}




                                {% if device.user_firstname != none %}
                                    <td class="td-class">{{ device.user_firstname }}</td>
                                {% elif device.user_firstname == none %}
                                    <td class="td-class"></td>
                                {% endif %}


                                {% if device.user_lastname != none %}
                                    <td class="td-class">{{ device.user_lastname }}</td>
                                {% elif device.user_lastname == none %}
                                    <td class="td-class"></td>
                                {% endif %}


                                {% if device.user_email != none %}
                                    <td class="td-class">{{ device.user_email }}</td>
                                {% elif device.user_email == none %}
                                    <td class="td-class"></td>
                                {% endif %}

                                {% if device.signature %}
                                <td class="td-class">
                                    <img src="{{ device.signature.url }}" alt="امضا" style="max-width: 100px; max-height: 50px;">
                                </td>
                                {% else %}
                                    <td class="td-class"></td>
                                {% endif %}


                                {% if device.department != none %}
                                    <td class="td-class">{{ device.department }}</td>
                                {% elif device.department == none %}
                                    <td class="td-class"></td>
                                {% endif %}


                                {% if device.room != none %}
                                    <td class="td-class">{{ device.room }}</td>
                                {% elif device.room == none %}
                                    <td class="td-class"></td>
                                {% endif %}


                                {% if device.floor != none %}
                                    <td class="td-class">{{ device.floor }}</td>
                                {% elif device.floor == none %}
                                    <td class="td-class"></td>
                                {% endif %}


                                {% if device.building_name != none %}
                                    <td class="td-class">{{ device.building_name }}</td>
                                {% elif device.building_name == none %}
                                    <td class="td-class"></td>
                                {% endif %}


                                {% if device.price != none %}
                                    <td class="td-class">{{ device.price }}</td>
                                {% elif device.price == none %}
                                    <td class="td-class"></td>
                                {% endif %}

                                <td class="td-class">
                                <a href="{% url 'export_single_device_excel' device.id %}" class="btn btn-md btn-outline-primary w-100">دانلود</a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
                </div>
            </div>
        </div>
    </section>
{% endblock content %}

{% block custom_js %}
    <script>
        $(document).ready(function () {

            //Dataset
            var subjects = {{data_name|safe}}
            var data_present = {{data_present}}
            var data_absent = {{data_absent}}

            //-------------
            //- DONUT CHART -
            var attendanceDataCanvas = $('#attendanceData').get(0).getContext('2d')
            var donutData = {
                labels: [
                    'Present', 'Absent'
                ],
                datasets: [
                    {
                        data: [{{percent_present}}, {{percent_absent}}],
                        backgroundColor: ['#00a65a', '#f56954'],
                    }
                ]
            }
            var donutOptions = {
                maintainAspectRatio: false,
                responsive: true,
            }
            var attendanceData = new Chart(attendanceDataCanvas, {
                type: 'doughnut',
                data: donutData,
                options: donutOptions
            });

            //attendanceStatistics
//Bar Chart
            var areaChartData = {
                labels: subjects,
                datasets: [
                    {
                        label: 'Present In Class',
                        backgroundColor: 'rgba(60,141,188,0.9)',
                        borderColor: 'rgba(60,141,188,0.8)',
                        pointRadius: false,
                        pointColor: '#3b8bba',
                        pointStrokeColor: 'rgba(60,141,188,1)',
                        pointHighlightFill: '#fff',
                        pointHighlightStroke: 'rgba(60,141,188,1)',
                        data: data_present
                    },

                    {
                        label: 'Absent In Class',
                        backgroundColor: 'rgba(210, 214, 222, 1)',
                        borderColor: 'rgba(210, 214, 222, 1)',
                        pointRadius: false,
                        pointColor: 'rgba(210, 214, 222, 1)',
                        pointStrokeColor: '#c1c7d1',
                        pointHighlightFill: '#fff',
                        pointHighlightStroke: 'rgba(220,220,220,1)',
                        data: data_absent
                    },
                ]
            }
            var barChartCanvas = $('#attendanceStatistics').get(0).getContext('2d')
            var barChartData = jQuery.extend(true, {}, areaChartData)
            var temp = areaChartData.datasets[0]
            barChartData.datasets[0] = temp
            var barChartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                datasetFill: false
            }

            var barChart = new Chart(barChartCanvas, {
                type: 'bar',
                data: barChartData,
                options: barChartOptions
            })


        })

    </script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.23.0/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-messaging.js"></script>


    <script>
        $(document).ready(function () {
            $("tr:even").css({
                "background-color": "#376a80",
            });
        });

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
            apiKey: "AIzaSyBarDWWHTfTMSrtc5Lj3Cdw5dEvjAkFwtM",
            authDomain: "sms-with-django.firebaseapp.com",
            databaseURL: "https://sms-with-django.firebaseio.com",
            projectId: "sms-with-django",
            storageBucket: "sms-with-django.appspot.com",
            messagingSenderId: "945324593139",
            appId: "1:945324593139:web:03fa99a8854bbd38420c86",
            measurementId: "G-2F2RXTL9GT"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig)
        const messaging = firebase.messaging();

        function InitializeFireBaseMessaging() {
            messaging
                .requestPermission()
                .then(function () {
                    console.log("Notification Permission");
                    return messaging.getToken();
                })
                .then(function (token) {
                    console.log("Token : " + token);
                    sendToServer(token);
                })
                .catch(function (reason) {
                    console.log(reason)
                })
        }

        messaging.onMessage(function (payload) {
            const notificationOption = {
                body: payload.notification.body,
                icon: payload.notification.icon,

            }
            if (Notification.permission == 'granted') {
                var notification = new Notification(payload.notification.title, notificationOption);
                notification.onclick = function (event) {
                    event.preventDefault();
                    window.open(payload.notification.click_action, "_blank");
                    notification.close();
                }
            }
            console.log(payload);
        });
        messaging.onTokenRefresh(function () {
            messaging.getToken()
                .then(function (newToken) {
                    console.log("New Token : " + newToken);
                    sendToServer(newToken);

                })
                .catch(function (reason) {
                    console.log(reason)
                })
        })

        function sendToServer(token) {
            $.ajax({
                url: "{% url 'all_fcmtoken' %}",
                type: 'POST',
                data: {
                    token: token,
                }
            }).done(function (response) {


            }).fail(function (response) {
            })

        }

        InitializeFireBaseMessaging();
    </script>

{% endblock custom_js %}

























































